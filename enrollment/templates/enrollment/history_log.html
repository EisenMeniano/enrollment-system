{% extends "base.html" %}
{% block title %}History Log{% endblock %}
{% block content %}
<div class="card">
  <h2>History Log</h2>
  <p>Recent enrollment actions (latest 200).</p>
  <div class="actions">
    {% if user.role == "ADVISER" %}
      <a class="btn" href="{% url 'enrollment:adviser_dashboard' %}">Back to Adviser</a>
    {% elif user.role == "FINANCE" %}
      <a class="btn" href="{% url 'enrollment:finance_dashboard' %}">Back to Finance</a>
    {% endif %}
  </div>
</div>

<div class="card" style="margin-top:14px;">
  <h3>Filters</h3>
  <form method="get">
    <div class="actions" style="align-items:flex-end;">
      <div style="min-width:220px;">
        <label for="action">Action</label>
        <select id="action" name="action">
          <option value="">All</option>
          {% for value,label in logs.model.Action.choices %}
            <option value="{{ value }}" {% if filter_action == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div style="min-width:220px;">
        <label for="student_name">Student Name</label>
        <input id="student_name" name="actor" type="text" value="{{ filter_actor }}">
      </div>
      <div style="min-width:220px;">
        <label for="student">Student No.</label>
        <input id="student" name="student" type="text" value="{{ filter_student }}">
      </div>
      <button class="btn equal" type="submit">Apply</button>
      <a class="btn equal" href="{% url 'enrollment:history_log' %}">Reset</a>
    </div>
  </form>
</div>

<div class="card" style="margin-top:14px;">
  <table>
    <thead>
      <tr>
        <th>Time</th>
        <th>Actor</th>
        <th>Student No.</th>
        <th>Term</th>
        <th>Action</th>
        <th>Message</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr>
        <td data-label="Time">{{ log.created_at|date:"Y-m-d H:i" }}</td>
        <td data-label="Actor">{{ log.actor.username|default:"System" }}</td>
        <td data-label="Student No.">
          {% if log.enlistment %}
            {{ log.enlistment.student.student_number }}
          {% else %}
            —
          {% endif %}
        </td>
        <td data-label="Term">
          {% if log.enlistment %}
            {{ log.enlistment.school_year }} - {{ log.enlistment.semester }}
          {% else %}
            —
          {% endif %}
        </td>
        <td data-label="Action"><span class="pill">{{ log.get_action_display }}</span></td>
        <td data-label="Message">{{ log.message }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="6">No history yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
