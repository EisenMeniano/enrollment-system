{% extends "base.html" %}
{% block title %}My Payment{% endblock %}
{% block content %}
<div class="layout">
  {% include "enrollment/_student_sidebar.html" with active="my_payment" %}
  <section>
    {% include "enrollment/_student_topinfo.html" %}
    <div class="section-card">
      <h3 class="section-title">My Payment</h3>
      <style>
        .pay-toolbar {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          align-items: end;
          margin-bottom: 10px;
        }
        .pay-toolbar .pay-field {
          width: 100%;
        }
        .pay-actions {
          display: inline-flex;
          gap: 8px;
          justify-content: flex-end;
          margin: 6px 0 16px;
        }
        .pay-field label {
          display: block;
          font-weight: 700;
          color: #263238;
          margin-bottom: 6px;
        }
        .pay-field label .req {
          color: #d32f2f;
          margin-right: 4px;
        }
        .pay-field select,
        .pay-field input {
          width: 100%;
          border: 1px solid #cfd8dc;
          border-radius: 6px;
          padding: 8px 10px;
          background: #fff;
        }
        .pay-actions .btn {
          padding: 6px 12px;
        }
        .section-subtitle {
          font-weight: 700;
          color: #37474f;
          display: inline-flex;
          align-items: center;
          gap: 8px;
          margin: 18px 0 10px;
        }
        .section-subtitle::before {
          content: "";
          width: 3px;
          height: 16px;
          background: #2e7d32;
          display: inline-block;
        }
        .fees-table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 18px;
          table-layout: fixed;
        }
        .fees-table th:first-child,
        .fees-table td:first-child {
          width: 70%;
        }
        .fees-table th.amount,
        .fees-table td.amount {
          width: 30%;
        }
        .fees-table .net-row td:first-child {
          text-align: left;
        }
        .fees-table .net-row td {
          border-bottom: 0;
        }
        .fees-table .net-row td.amount {
          border-left: 0;
          text-align: right;
        }
        .fees-table th,
        .fees-table td {
          border: 1px solid #e0e0e0;
          padding: 10px;
          text-align: left;
        }
        .fees-table thead th {
          background: #f3f7ff;
          color: #455a64;
          font-weight: 700;
        }
        .fees-table .amount {
          text-align: right;
          white-space: nowrap;
        }
        .pay-row {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          margin: 14px 0 6px;
        }
        .pay-card {
          border: 1px solid #e0e0e0;
          border-radius: 10px;
          padding: 16px 18px;
          background: #fff;
          box-shadow: 0 8px 24px rgba(16, 24, 40, 0.08);
        }
        .pay-card h4 {
          margin: 0 0 12px;
          font-size: 15px;
          font-weight: 700;
          color: #2f3b45;
          display: inline-flex;
          align-items: center;
          gap: 8px;
        }
        .pay-card h4::before {
          content: "";
          width: 3px;
          height: 18px;
          background: #2e7d32;
          display: inline-block;
        }
        .pay-card .amount-box {
          border: 1px solid #e0e0e0;
          border-radius: 8px;
          padding: 12px 14px;
          display: grid;
          grid-template-columns: 1fr auto;
          align-items: center;
          font-weight: 700;
          color: #263238;
          background: #fff;
        }
        .pay-card .amount-box .amount-value {
          color: #1565c0;
        }
        .pay-card .pay-action {
          text-align: right;
          margin-top: 12px;
        }
        .pay-card .pay-action .btn {
          padding: 6px 14px;
          border-radius: 999px;
        }
        .pay-online {
          display: inline-block;
          border: 1px solid #29b6f6;
          color: #29b6f6;
          padding: 6px 12px;
          border-radius: 6px;
          background: #fff;
          font-weight: 700;
        }
        .receipts-table {
          width: 100%;
          border-collapse: collapse;
        }
        .receipts-table th,
        .receipts-table td {
          border: 1px solid #e0e0e0;
          padding: 8px 10px;
          text-align: left;
          font-size: 13px;
        }
        .receipts-table thead th {
          background: #f3f7ff;
          color: #455a64;
          font-weight: 700;
        }
        .status-complete {
          color: #2e7d32;
          font-weight: 700;
        }
        @media (max-width: 900px) {
          .pay-toolbar {
            grid-template-columns: 1fr;
          }
          .pay-row {
            grid-template-columns: 1fr;
          }
        }
      </style>

      <div class="pay-toolbar">
        <div class="pay-field">
          <label><span class="req">*</span>Payment Type</label>
          <select id="paymentType">
            <option value="">Please Select</option>
            <option value="FULL">Full Payment</option>
            <option value="INSTALLMENT">Installment</option>
          </select>
        </div>
        <div class="pay-field">
          <label><span class="req">*</span>Semester</label>
          <select id="paymentSemester">
            {% if latest_enlistment %}
              <option value="">---</option>
              <option>{{ latest_enlistment.school_year }} - {{ latest_enlistment.semester }}</option>
            {% else %}
              <option value="">---</option>
            {% endif %}
          </select>
        </div>
        <div class="pay-actions">
          <button class="btn" id="btnShowPayment" type="button">Show</button>
          <button class="btn secondary" id="btnClearPayment" type="button">Clear</button>
        </div>
      </div>

      <div class="section-subtitle">Fees Details</div>
      <table class="fees-table">
        <thead>
          <tr>
            <th>Payment Type</th>
            <th class="amount">Amount</th>
          </tr>
        </thead>
        <tbody>
          <tr data-fee="installment">
            <td>DOWN PAYMENT AMOUNT</td>
            <td class="amount">{{ payment_breakdown.down_payment|floatformat:2 }}</td>
          </tr>
          <tr data-fee="installment">
            <td>Prelim (1st Term)</td>
            <td class="amount">{{ payment_breakdown.prelim|floatformat:2 }}</td>
          </tr>
          <tr data-fee="installment">
            <td>Midterm (2nd Term)</td>
            <td class="amount">{{ payment_breakdown.midterm|floatformat:2 }}</td>
          </tr>
          <tr data-fee="installment">
            <td>Final (3rd Term)</td>
            <td class="amount">{{ payment_breakdown.final|floatformat:2 }}</td>
          </tr>
          <tr data-fee="full">
            <td>FULL PAYMENT</td>
            <td class="amount">{{ payment_breakdown.total|floatformat:2 }}</td>
          </tr>
          <tr>
            <td style="font-weight:700;">Total Amount</td>
            <td class="amount" style="font-weight:700;">{{ payment_breakdown.total|floatformat:2 }}</td>
          </tr>
        </tbody>
      </table>

      <div class="pay-row">
        <div class="pay-card">
          <h4>Pay In Cash</h4>
          <div class="amount-box">
            <span>Amount :</span>
            <span class="amount-value">0.00</span>
          </div>
        </div>
        <div class="pay-card">
          <h4>Pay Online</h4>
          <div class="amount-box">
            <span>Amount :</span>
            <span class="amount-value">0.00</span>
          </div>
          <div class="pay-action">
            <button class="btn" type="button">Pay Online</button>
          </div>
        </div>
      </div>

      <p class="verify-note">Dear {{ user.first_name|default:"Student" }} {{ user.last_name|default:"" }}, Your payment is verified.</p>

      <div class="section-subtitle">Previous Receipts Information</div>
      <table class="receipts-table">
        <thead>
          <tr>
            <th>Sr.No.</th>
            <th>Receipt Type</th>
            <th>Receipt No</th>
            <th>Order Id</th>
            <th>Date</th>
            <th>Semester</th>
            <th>Pay Type</th>
            <th>Amount</th>
            <th>Payment Status</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>DP</td>
            <td>--</td>
            <td>--</td>
            <td>--</td>
            <td>
              {% if latest_enlistment %}
                {{ latest_enlistment.semester }}
              {% else %}
                ---
              {% endif %}
            </td>
            <td>CASH</td>
            <td>
              {% if latest_enlistment and latest_enlistment.payment %}
                {{ latest_enlistment.payment.amount }}
              {% else %}
                0.00
              {% endif %}
            </td>
            <td class="status-complete">COMPLETE</td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>
<script>
  (function () {
    var showBtn = document.getElementById("btnShowPayment");
    var clearBtn = document.getElementById("btnClearPayment");
    var typeSelect = document.getElementById("paymentType");
    var semesterSelect = document.getElementById("paymentSemester");
    var feeRows = document.querySelectorAll("[data-fee]");

    function setFeeVisibility(mode) {
      feeRows.forEach(function (row) {
        var feeType = row.getAttribute("data-fee");
        if (!mode) {
          row.style.display = "";
          return;
        }
        row.style.display = feeType === mode ? "" : "none";
      });
    }

    function showResults() {
      if (typeSelect.value && semesterSelect.value) {
        setFeeVisibility(typeSelect.value === "FULL" ? "full" : "installment");
      }
    }

    function clearResults() {
      typeSelect.value = "";
      semesterSelect.value = "";
      setFeeVisibility(null);
    }

    showBtn.addEventListener("click", showResults);
    clearBtn.addEventListener("click", clearResults);
  })();
</script>
{% endblock %}
