{% extends "base.html" %}
{% block title %}Student Profile{% endblock %}
{% block content %}
<div class="layout">
  <aside class="side-nav">
    <h4>Student Profile</h4>
    <a class="active" href="#personal">Personal Details</a>
    <a href="#address">Address Details</a>
    <a href="#course">Course Details</a>
    <a href="#enlistments">Enlisted Subjects</a>
    <a href="#schedule">Class Schedule</a>
  </aside>

  <section>
    <div class="section-card" id="personal">
      <h3 class="section-title">Personal Details</h3>
      <div class="info-grid">
        <div class="info-row"><strong>Student ID</strong><span>{{ user.student_number }}</span></div>
        <div class="info-row"><strong>Course</strong><span>{{ profile.program|default:"?" }}</span></div>
        <div class="info-row"><strong>Campus</strong><span>?</span></div>
        <div class="info-row"><strong>Curriculum</strong><span>?</span></div>
        <div class="info-row"><strong>College</strong><span>?</span></div>
        <div class="info-row"><strong>Semester Name</strong>
          <span>{% if latest_enlistment %}{{ latest_enlistment.semester }}{% else %}?{% endif %}</span>
        </div>
      </div>

      <div class="field-grid" style="margin-top:14px;">
        <div class="field">
          <label>Last Name</label>
          <div class="value">{{ user.last_name|default:"?" }}</div>
        </div>
        <div class="field">
          <label>First Name</label>
          <div class="value">{{ user.first_name|default:"?" }}</div>
        </div>
        <div class="field">
          <label>Email</label>
          <div class="value">{{ user.email|default:"?" }}</div>
        </div>
        <div class="field">
          <label>Year Level</label>
          <div class="value">{{ profile.year_level|default:"?" }}</div>
        </div>
      </div>
    </div>

    <div class="section-card" id="address">
      <h3 class="section-title">Address Details</h3>
      <p class="subtle">No address data yet.</p>
    </div>

    <div class="section-card" id="course">
      <h3 class="section-title">Course Details</h3>
      <div class="info-grid">
        <div class="info-row"><strong>Program</strong><span>{{ profile.program|default:"?" }}</span></div>
        <div class="info-row"><strong>Year Level</strong><span>{{ profile.year_level|default:"?" }}</span></div>
      </div>
    </div>

    <div class="section-card" id="enlistments">
      <h3 class="section-title">Enlisted Subjects</h3>
      <div class="actions" style="margin-bottom:8px;">
        <a class="btn" href="{% url 'enrollment:enlistment_create' %}">Apply for Enlistment</a>
      </div>
      <table>
        <thead>
          <tr><th>Category</th><th>Program</th><th>Term</th><th>Status</th><th>Actions</th></tr>
        </thead>
        <tbody>
          {% for e in enlistments %}
          <tr>
            <td data-label="Category">{{ e.category.name|default:"?" }}</td>
            <td data-label="Program">{{ e.program.name|default:"?" }}</td>
            <td data-label="Term">{{ e.school_year }} - {{ e.semester }}</td>
            <td data-label="Status"><span class="pill">{{ e.get_status_display }}</span></td>
            <td data-label="Actions">
              <a class="btn gray" href="{% url 'enrollment:enlistment_detail' e.id %}">View</a>
              {% if e.status == "APPROVED_FOR_PAYMENT" %}
                <a class="btn" href="{% url 'enrollment:student_pay' e.id %}">Proceed to Payment</a>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr><td colspan="5">No enlistments yet.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="section-card" id="schedule">
      <h3 class="section-title">Class Schedule</h3>
      <p class="subtle">Schedule details will appear here.</p>
    </div>

    <div class="section-card" id="finance-flow">
      <h3 class="section-title">Admin/Finance Account Flow</h3>
      <p class="subtle">Finance-only flow based on the diagram.</p>
      <style>
        .finance-only {
          margin-top: 12px;
          display: grid;
          justify-items: center;
          gap: 10px;
        }
        .fo-node {
          padding: 8px 14px;
          border-radius: 10px;
          border: 2px solid #c62828;
          color: #c62828;
          font-weight: 700;
          text-align: center;
          background: #fff6f6;
          min-width: 220px;
        }
        .fo-node.gray {
          border-color: #9e9e9e;
          color: #444;
          background: #f5f5f5;
        }
        .fo-diamond {
          width: 140px;
          height: 140px;
          display: grid;
          place-items: center;
          transform: rotate(45deg);
        }
        .fo-diamond span {
          transform: rotate(-45deg);
          display: block;
          padding: 0 8px;
        }
        .fo-arrow {
          font-size: 20px;
          font-weight: 700;
          color: #c62828;
        }
        .fo-branch {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 16px;
          width: 100%;
          max-width: 640px;
        }
        .fo-branch-col {
          display: grid;
          justify-items: center;
          gap: 8px;
        }
        .fo-label {
          font-size: 12px;
          font-weight: 700;
          text-transform: uppercase;
          letter-spacing: 0.06em;
          color: #555;
        }
        @media (max-width: 820px) {
          .fo-branch {
            grid-template-columns: 1fr;
          }
          .fo-node {
            min-width: 200px;
          }
          .fo-diamond {
            width: 120px;
            height: 120px;
          }
        }
      </style>
      <div class="finance-only">
        <div class="fo-node gray">Admin/Finance Account</div>
        <div class="fo-arrow">|</div>
        <div class="fo-node gray">Check Student Balance</div>
        <div class="fo-arrow">|</div>
        <div class="fo-node fo-diamond"><span>Unpaid Balance?</span></div>

        <div class="fo-branch">
          <div class="fo-branch-col">
            <div class="fo-label">Yes</div>
            <div class="fo-node">Hold/Disapprove</div>
            <div class="fo-node gray">Notify Student to Settle Balance</div>
          </div>
          <div class="fo-branch-col">
            <div class="fo-label">No</div>
            <div class="fo-node gray">Check Previous Sem Grades</div>
          </div>
        </div>

        <div class="fo-arrow">|</div>
        <div class="fo-node fo-diamond"><span>Passed / No Issues?</span></div>

        <div class="fo-branch">
          <div class="fo-branch-col">
            <div class="fo-label">No</div>
            <div class="fo-node">Hold/Disapprove</div>
            <div class="fo-node gray">Notify Adviser or Student</div>
          </div>
          <div class="fo-branch-col">
            <div class="fo-label">Yes</div>
            <div class="fo-node gray">Proceed to Payment</div>
            <div class="fo-node fo-diamond"><span>Payment Successful?</span></div>
            <div class="fo-branch" style="grid-template-columns: 1fr 1fr; max-width: 360px;">
              <div class="fo-branch-col">
                <div class="fo-label">No</div>
                <div class="fo-node gray">Retry Payment</div>
              </div>
              <div class="fo-branch-col">
                <div class="fo-label">Yes</div>
                <div class="fo-node">Enrollment Confirmed</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
{% endblock %}
